<div class="wrapper">
  <app-navbar></app-navbar>
  <div class="card m-2">
    <div class="card-header">
      <h4>Listado de Guias</h4>
    </div>
    <div class="card-body">

      <div class="row mb-2">
        <div class="col-md-3 col-sm-4 col-lg-2">
          <label class="w-100">Desde:</label>
          <input type="date" [(ngModel)]="desde" class="form-control w-100">
        </div>
        <div class="col-md-3 col-sm-4 col-lg-2">
          <label class="w-100">Hasta:</label>
          <input type="date" [(ngModel)]="hasta" class="form-control w-100">
        </div>

        <div class="col-md-3 col-sm-4 col-lg-2" style="margin-bottom: 5px;">
          <label for="" class="w-100">Filtrar por serie:</label><br>
          <input type="text" class="form-control w-100" maxlength="13" style="width: 250px" placeholder="Buscar.." [(ngModel)]="filterSerie"
            name="filterpost" />
        </div>

        <div class="col-md-3 col-sm-4 col-lg-3">
          <label for="" class="w-100">Estado:</label>
          <select [value]="filtroEstado" id="filtroSelect" class="form-select w-100"
            (change)="llenarFiltro('filtroSelect')">
            <option value="">Todos</option>
            <option value="N">Generado</option>
            <option value="A">En proceso</option>
            <option value="E">Error</option>
            <option value="L">Enviado</option>
          </select>
        </div>

        <div class="col-md-6 col-sm-4 col-lg-1">
          <div>
            <button class="btn btn-primary mt-4" style="white-space: nowrap;" (click)="buscarReporteRango()">Buscar
              <i class="fa-solid fa-magnifying-glass text-white" ></i>
            </button>
          </div>
        </div>
        <div class="col-md-6 col-sm-4 col-lg-2" >
          <button class="btn btn-success mt-4 float-end me-2" style="white-space: nowrap;" (click)="exportToExcel()">Exportar <i class="fa fa-file-excel"></i></button>
        </div>
      </div>
      <div class="table table-responsive">
        <table class="table table-bordered">
          <thead>
            <th style="min-width: 100px;">Serie</th>
            <th>Estado</th>
            <th>fecha de Emision</th>
            <th>Correo</th>
            <th>N° Doc Adquiriente</th>
            <th>Tipo Doc Adquiriente</th>
            <th>Adquiriente</th>
            <th>Motivo Traslado</th>
            <th>Descripción</th>
            <th>Peso Total</th>
            <th>Fecha inicio</th>
            <th>Estado Bl</th>
            <th>Opt</th>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of spe_despatch | filter:filtroEstado:['bl_estadoRegistro']| filter:filterSerie:['serieNumeroGuia'] |paginate: { id:'pageReport',itemsPerPage: 10, currentPage: page}">
              <td>{{item.serieNumeroGuia}}</td>
              <td>
                <span class="badge text-bg-primary" *ngIf="item.bl_estadoRegistro=='N'">Generado</span>
                <span class="badge text-bg-warning" *ngIf="item.bl_estadoRegistro=='A'">En proceso</span>
                <span class="badge text-bg-danger" *ngIf="item.bl_estadoRegistro=='E'">Error</span>
                <span class="badge text-bg-success" *ngIf="item.bl_estadoRegistro=='L'">Enviado</span>
              <td>{{item.fechaEmisionGuia}}</td>
              <td>{{item.correoDestinatario}}</td>
              <td>{{item.numeroDocumentoDestinatario}}</td>
              <td>{{item.tipoDocumentoDestinatario}}</td>
              <td>{{item.razonSocialDestinatario}}</td>
              <td>{{item.motivoTraslado}}</td>
              <td>{{item.descripcionMotivoTraslado}}</td>
              <td>{{item.pesoBrutoTotalBienes}}</td>
              <td>{{item.fechaInicioTraslado}}</td>
              <td>
                <span class="badge text-bg-primary" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED/AC_03'" (click)="MostrarEstado(item.bl_mensajeSunat)">ACEPTADO</span>
                <span class="badge text-bg-warning" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED/PE_02'" (click)="MostrarEstado(item.bl_mensajeSunat)">EN PROCESO</span>
                <span class="badge text-bg-warning" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED/PE_09'" (click)="MostrarEstado(item.bl_mensajeSunat)">EN PROCESO</span>
                <span class="badge text-bg-danger" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED'" (click)="MostrarEstado(item.bl_mensajeSunat)">ERROR LOCAL</span>
                <span class="badge text-bg-danger" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED/AN_04'" (click)="MostrarEstado(item.bl_mensajeSunat)">ANULADO</span>
                <span class="badge text-bg-danger" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='SIGNED/RC_05'" (click)="MostrarEstado(item.bl_mensajeSunat)">RECHAZADO</span>
                <span class="badge text-bg-success" style="cursor: pointer" *ngIf="item.bl_estadoProceso=='L'" (click)="MostrarEstado(item.bl_mensajeSunat)">Enviado</span>
             </td>
              <td>
                <i *ngIf="item.bl_url_pdf!=undefined" (click)="descargarPdf(item.bl_url_pdf,(item.serieNumeroGuia+'.pdf'),'application/json')" class="bi bi-file-earmark-pdf me-3" style="font-size: 25px;color: rgb(3, 133, 255);cursor: pointer;" ></i>
                <i *ngIf="item.bl_url_pdf!=undefined" (click)="descargarPdf(item.bl_url_cdr,(item.serieNumeroGuia+'.cdr'),'application/cdr')" class="bi bi-file-earmark-medical me-3" style="font-size: 25px;color: rgb(3, 133, 255);cursor: pointer;" ></i>
                <i *ngIf="item.bl_url_pdf!=undefined" (click)="descargarPdf(item.bl_xml_rsp,(item.serieNumeroGuia+'.xml'),'application/xml')" class="bi bi-filetype-xml me-3" style="font-size: 25px;color: rgb(3, 133, 255);cursor: pointer;" ></i>
              <i (click)="abrirModal(DetallesSpe,item.serieNumeroGuia)" class="fa-sharp fa-solid fa-circle-info"
                  style="font-size: 25px;color: rgb(3, 133, 255);cursor: pointer;"></i></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div style="text-align: center;"><pagination-controls id="pageReport"
          (pageChange)="page = $event"></pagination-controls></div>

    </div>
  </div>
</div>
<ng-template #DetallesSpe>
  <div class="card">
    <div class="card-header text-center">
      <h5>Detalles</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive" style="max-height: 800px;">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th scope="col">N° Orden</th>
              <th scope="col">Serie</th>
              <!--               <th scope="col">Tipo Documento Guia</th> -->
              <th scope="col">Cantidad</th>
              <th scope="col">UnidadMedida</th>
              <th scope="col">Descripcion</th>
              <th scope="col">Codigo</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of spe_despatch_item" style="cursor: pointer;">
              <th scope="row">{{item.numeroOrdenItem}}</th>
              <!--               <td>{{item.tipoDocumentoRemitente}}</td>
              <td>{{item.numeroDocumentoRemitente}}</td> -->
              <td>{{item.serieNumeroGuia}}</td>
              <!--         <td>{{item.tipoDocumentoGuia}}</td> -->
              <td>{{item.cantidad}}</td>
              <td>{{item.unidadMedida}}</td>
              <td>{{item.descripcion}}</td>
              <td>{{item.codigo}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>
